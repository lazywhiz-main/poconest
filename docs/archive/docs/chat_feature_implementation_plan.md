# PocoNest チャット機能 実装計画

## 1. 概要

PocoNestのチャット機能を、単なるメッセージング機能から「インサイトを生み出す対話の場」へと進化させるための実装計画です。「Poco」というリスのキャラクターを中心に、会話から得られる知見を収集・整理する体験を提供します。

## 2. 実装フェーズ

実装は以下の4つのフェーズに分けて、段階的に進めていきます。各フェーズで既存機能との互換性を保ちながら、新機能を追加していきます。

### フェーズ1: 基盤強化 (Foundation)

**目標**: ポコの基本的な存在感と対話の仕組みを実装

1. **チャットUIの基本強化**
   - メッセージバブルのデザイン改善
   - 既読状態の視覚的表示

2. **ポコの基本表示**
   - チャット画面の片隅にポコのアイコンを表示
   - 基本的なアニメーション（アイドル状態、リアクション）

3. **基本的なチャットサポート機能**
   - 簡単な挨拶応答
   - 会話が途切れた時の基本的な介入

**成果物**:
- ポコの存在感が感じられるチャットUI
- 基本的なインタラクションの土台

### フェーズ2: インサイト処理 (Insights)

**目標**: 会話からインサイトを抽出する基本機能を実装

1. **会話要約機能**
   - 一定量の会話後に要約を生成
   - 要約のポップアップ表示

2. **キーワード抽出**
   - 会話中の重要キーワードのハイライト
   - タップでキーワードに関連する情報表示

3. **シンプルなボード連携**
   - 重要なメッセージをボードに保存する機能
   - 簡単なタグ付け機能

**成果物**:
- 基本的なインサイト抽出機能
- ボードとの初期連携

### フェーズ3: インタラクション強化 (Interaction)

**目標**: ポコとのインタラクションを豊かにし、より自然な対話を実現

1. **会話状態検知**
   - 会話の流れ、感情、トピックの自動検知
   - 文脈に応じた適切な介入

2. **アドバンストアニメーション**
   - ポコの多様な感情表現
   - 状況に応じたアニメーション変化

3. **質問生成と進行補助**
   - 会話を深める質問の自動生成
   - 議論が停滞した際の進行補助

**成果物**:
- より自然で流れのある対話体験
- 感情豊かなポコのインタラクション

### フェーズ4: エコシステム統合 (Integration)

**目標**: 他の機能と緊密に連携し、アプリ全体のエコシステムを形成

1. **インサイトエリアの実装**
   - チャット画面上部に「今日のインサイト」エリアを追加
   - ドラッグ＆ドロップでボードに移動可能

2. **検索機能との連携**
   - 過去の会話からの関連情報提案
   - コンテキストに応じた情報検索

3. **パーソナライズと学習**
   - チームの用語や文化の学習
   - ユーザー好みに合わせた介入頻度調整

**成果物**:
- アプリ全体と統合されたチャット体験
- パーソナライズされた知的サポート

## 3. 技術要件

### 3.1 フロントエンド

- **UIコンポーネント**:
  - ChatMessageComponent (強化版)
  - PocoAnimationComponent (新規)
  - InsightCardComponent (新規)
  - ReactionButtonsComponent (新規)

- **状態管理**:
  - チャットコンテキスト拡張
  - インサイト管理コンテキスト (新規)

### 3.2 バックエンド

- **データモデル拡張**:
  - messages テーブル (既存、拡張)
    - is_insight: boolean
    - insight_type: string
    - keywords: string[]
  - insights テーブル (新規)
    - id: uuid
    - chat_id: uuid
    - content: string
    - created_at: timestamp
    - source_messages: uuid[]

- **API拡張**:
  - getInsightsFromChat
  - saveMessageAsInsight
  - generateChatSummary

### 3.3 AI/ML機能

- **テキスト分析**:
  - キーワード抽出
  - 感情分析
  - トピック識別

- **会話支援**:
  - 要約生成
  - 質問生成
  - 関連性検出

## 4. UI/UXデザイン詳細

### 4.1 ポコのビジュアルプレゼンス

- **位置**: チャット画面右下
- **サイズ**: 通常時は小さく、アクティブ時に少し大きく
- **状態**:
  - アイドル: 小さく揺れる動き
  - リスニング: わずかに首を傾ける
  - 思考中: 目を閉じて考える
  - 話す: 口が動く
  - 喜び: ぴょんと跳ねる

### 4.2 メッセージレイアウト

- **自分のメッセージ**: 右寄り、青系の色調
- **相手のメッセージ**: 左寄り、緑系の色調
- **ポコのメッセージ**: 中央寄り、オレンジ系の色調
- **形状**: 自然な葉っぱ型のバブル
- **アニメーション**: 表示時に軽く弾む

### 4.3 インサイトエリア

- **位置**: チャット画面上部
- **デザイン**: 水平スクロール可能なカード
- **カード内容**: 要約、キーワード、提案
- **操作**: ドラッグでボードに移動可能

### 4.4 リアクション機能

- **位置**: メッセージ長押し時に表示
- **種類**: 「重要」「後で確認」「ボードに保存」など
- **表示**: 軽量なアイコン群

## 5. テストとフィードバック計画

### 5.1 各フェーズのテスト

- **フェーズ1**: UI/UXテスト、基本的な使用感
- **フェーズ2**: インサイト抽出の精度テスト
- **フェーズ3**: インタラクションの自然さテスト
- **フェーズ4**: 統合テスト、全体の整合性

### 5.2 フィードバックループ

- 各フェーズ後にユーザーフィードバックを収集
- フィードバックに基づいて次フェーズの微調整
- A/Bテストによる最適化

## 6. 予想される課題と対策

### 6.1 技術的課題

- **インサイト抽出精度**: 初期は簡易アルゴリズムから始め、徐々に精度向上
- **リアルタイム処理**: 処理の一部をバックグラウンドで実行
- **バッテリー消費**: 必要最小限の処理に留める

### 6.2 UX課題

- **ポコの介入頻度**: ユーザー設定で調整可能に
- **情報過多**: 最初はミニマルな表示から始める
- **学習曲線**: チュートリアルと徐々に機能を紹介

## 7. タイムライン

- **フェーズ1**: 2週間
- **フェーズ2**: 3週間
- **フェーズ3**: 3週間
- **フェーズ4**: 4週間

合計: 約3ヶ月

## 8. 成功指標

- **エンゲージメント**: チャット使用頻度の向上
- **有用性**: ボードに保存されるインサイト数
- **満足度**: ユーザーフィードバックスコア
- **機能採用率**: 新機能の使用率

## 9. 結論

PocoNestのチャット機能強化は、単なる機能追加ではなく、アプリの核となる「会話からの学び」というコンセプトを深め、具現化するための重要な取り組みです。段階的かつ慎重に進めることで、既存の良い部分を維持しながら、新しい価値を創出していきます。

ポコというキャラクターを通じて、会話を単なる情報交換から「知恵を育む場」へと変えていくビジョンを実現します。 