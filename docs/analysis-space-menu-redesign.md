# 分析スペースUI整理計画

## 🎯 課題と目標

### 現在の問題
- 分析スペースに多くのボタンが横並びで表示され、UI が煩雑
- 機能的な関連性がある操作が散在している
- 新しい分析手法の追加により今後さらに複雑化する恐れ

### 目標
- 機能グループ別にメニューを整理
- サイドピーク方式で詳細設定画面を提供
- 直感的で使いやすいUI構造を実現

## 📋 現在の分析スペース機能完全マッピング

### Relations関連（7機能）
1. **🔗 Relationships（統合関係性分析）** - `runUnifiedRelationshipAnalysis('incremental')`
2. **🗑️ Relations一括削除** - Relations削除オプション選択
3. **🧹 Relations重複削除** - `handleRelationsDeduplication`
4. **🎛️ パラメータ設定** - `setShowParameterSettings(true)`
5. **🔍 Relations分析** - `handleRelationsAnalysis`
6. **🧠 統合分析（実験版）** - `handleUnifiedAnalysis`
7. **完全分析強制実行** - `runUnifiedRelationshipAnalysis('full')`

### Clustering関連（1メインボタン + 内部3タブ）
1. **🎛️ Clustering** - `setShowClusteringControls(!showClusteringControls)`
   - **シンプル** - 基本クラスタリング設定
   - **高度解析 🔬** - 高度なクラスタリング設定
   - **保存済みビュー 📚** - ClusterViewManagerコンポーネント

### Theory Building関連（1機能）
1. **🧠 理論構築（Grounded Theory）** - `setShowGroundedTheoryManager(true)`

### View・Navigation関連（4機能）
1. **Reset View** - `resetView()` - ビューポートを初期位置にリセット
2. **🗺️ Mini Map** - `setShowMinimap(!showMinimap)` - ミニマップ表示切り替え
3. **Auto Layout** - `applyForceLayout()` - ノード自動配置実行
4. **💾 Views** - `setShowViewManager(!showViewManager)` - ビュー保存・管理

### Floating Controls（画面右下固定）
1. **+ ズームイン** - `zoomIn()` - ビューポートスケール拡大
2. **− ズームアウト** - `zoomOut()` - ビューポートスケール縮小
3. **Minimap表示** - showMinimap状態に応じて表示（200x150px）

### Search & Filter関連（左下フィルター領域）
1. **ノード検索機能** - カード内容・タイトル・作成者・ノードID検索
2. **ノート（カード）フィルタリング** - カードタイプ・タグ・日時・作成者別
3. **関係性フィルタリング** - 関係性タイプ・強度・作成日時別
4. **表示制御** - ノード・エッジの表示/非表示制御

### その他UI要素
1. **関係性候補表示パネル** - Relations作成後の結果表示（Relationsサイドピークに統合予定）
2. **各種設定モーダル** - パラメータ設定、分析設定等

## 🎨 新メニュー構造設計

### メインメニュー（5つのカテゴリー）

#### 1. **Relations** 🔗
- **メニューチップ**: "関係性の生成・管理・分析"
- **サイドピーク内容**: タブ表示＋パネル内トグルで畳める構成

#### 2. **Clustering** 🎛️  
- **メニューチップ**: "ノードのグループ化と可視化"
- **サイドピーク内容**: タブ表示

#### 3. **Theory Building** 🧠
- **メニューチップ**: "仮説抽出と理論構築"
- **サイドピーク内容**: 分析手法別

#### 4. **View & Navigation** 🗺️
- **メニューチップ**: "ビューポート操作・レイアウト制御"
- **サイドピーク内容**: 直接実行ボタン + 設定

#### 5. **Search & Filter** 🔍
- **メニューチップ**: "ノード検索・フィルタリング"
- **サイドピーク内容**: 検索条件設定エリア（旧左下フィルター領域）

### フローティングコントロール（従来通り右下固定）
- **+ / − ズームコントロール** - 直接操作用（View & Navigationでは制御しない）
- **Minimap** - ナビゲーション用（表示/非表示切り替えは View & Navigation で管理）

## 📐 詳細設計

### Relations サイドピーク構成

#### タブ1: 作成・設定 ⚡
```
🎛️ 分析パラメータ設定
├─ AI分析設定
├─ 類似性閾値  
├─ 信頼度設定
└─ その他詳細パラメータ

⚡ 関係性生成実行
├─ 🔗 統合分析（増分）    ← 現在のRelationships
├─ 🚀 完全再分析          ← 現在の完全分析強制実行
└─ 🧠 統合分析（実験版）   ← 現在の統合分析（実験版）

📋 分析結果表示・承認（実行後に表示）
├─ 提案リスト表示         ← 現行の結果表示パネル
├─ 承認/却下操作
├─ 強度調整
└─ 一括操作
```

#### タブ2: 関係性一覧・管理 🗂️
```
📊 品質分析・評価
├─ 🔍 品質分析実行       ← 現在のRelations分析（移動）
├─ 📈 品質レポート表示
└─ 🎯 改善提案

🗂️ 関係性一覧・管理
├─ 📊 現在の関係性リスト
│   ├─ 関係性タイプ別表示
│   ├─ 強度別フィルタリング
│   ├─ 作成日時・作成者情報
│   └─ 個別編集・削除
├─ 🗂️ 一括管理
│   ├─ 🗑️ 一括削除         ← 現在のRelations一括削除
│   ├─ 🧹 重複削除         ← 現在のRelations重複削除
│   └─ 📊 データエクスポート ← 新機能（今後）
└─ 📈 統計情報
    ├─ 関係性数サマリー
    ├─ タイプ別分布
    └─ 品質スコア
```

### Clustering サイドピーク構成

#### タブ1: クラスタリング実施 🎛️
```
🎛️ クラスタリング実施
├─ 📋 条件設定
│   ├─ シンプル設定      ← 現在のシンプルモード
│   ├─ 高度設定 🔬      ← 現在の高度解析
│   └─ 実行ボタン
└─ 📊 結果
    ├─ 結果プレビュー    ← 実行後のクラスター情報
    ├─ クラスター統計
    └─ 💾 結果を保存ボタン
```

#### タブ2: 表示中のクラスター 📌
```
📌 表示中のクラスター
├─ 🎯 現在表示中のクラスター一覧  ← 現在の左下フィルター領域から移行
│   ├─ クラスターリスト
│   ├─ 各クラスターのカード一覧
│   ├─ クラスター選択・フィルタリング
│   └─ 表示切り替え（表示/非表示）
├─ 📊 クラスター詳細情報
│   ├─ 選択中クラスターの統計
│   ├─ 含まれるカード詳細
│   └─ 関係性密度
└─ ⚙️ 表示設定
    ├─ ラベル表示切り替え
    ├─ 色分け設定
    └─ 透明度調整
```

#### タブ3: 保存済みビュー 📚  
```
📚 保存済みビュー
├─ 📋 保存済みビューリスト    ← 現在のClusterViewManager
├─ 🔄 ビュー読み込み
├─ 🗑️ ビュー削除
└─ 📝 ビュー詳細情報
    ├─ 作成日時・説明
    ├─ クラスター数・ノード数
    └─ プレビューサムネイル
```
※読み込み時は「表示中のクラスター」タブにデータが反映される

### Theory Building サイドピーク構成

#### 分析手法メニュー
```
🧠 Theory Building
├─ Grounded Theory Analysis ← 現在の理論構築
│   ├─ 新しく分析
│   ├─ 保存済み分析リスト
│   └─ 分析管理
└─ （今後の分析手法追加エリア）
    ├─ Narrative Analysis（予定）
    ├─ Thematic Analysis（予定）
    └─ ...
```

**Grounded Theory Analysis選択時**:
- 現在の理論構築ボタン押下時のGroundedTheoryManagerを広めのサイドピークで表示

### View & Navigation サイドピーク構成

#### 直接実行ボタン
```
🎮 ビューポート操作
├─ 🔄 Reset View         ← 現在のReset View（クリックで即実行）
├─ 🎯 Auto Layout        ← 現在のAuto Layout（クリックで即実行）
└─ 🗺️ Minimap表示切り替え ← 現在のMini Map（ON/OFF切り替え）
```

#### ビュー保存・管理（Views機能統合）
```
💾 ビュー保存・管理
├─ 💾 現在のビューを保存 ← 現在のViews機能の保存部分
├─ 📋 保存済みビューリスト ← 現在のViews機能のリスト部分
├─ 🔄 ビュー読み込み    ← 現在のViews機能の読み込み部分
└─ 🗑️ ビュー削除       ← 現在のViews機能の削除部分
```

### Search & Filter サイドピーク構成

#### ノード検索・フィルタリング（旧左下フィルター領域）
```
🔍 ノード検索・フィルタリング
├─ 🔍 検索機能
│   ├─ カード内容検索     ← 全文検索
│   ├─ タイトル検索      ← 部分一致検索
│   ├─ 作成者検索        ← ユーザー名検索
│   └─ ノードID検索      ← 直接指定
├─ 🏷️ ノート（カード）フィルター
│   ├─ カードタイプ別    ← INBOX/QUESTIONS/INSIGHTS等
│   ├─ タグ別           ← タグによるフィルタリング
│   ├─ 作成日時別       ← 期間指定フィルタリング
│   └─ 作成者別         ← ユーザー別フィルタリング
├─ 🔗 関係性フィルター
│   ├─ 関係性タイプ別    ← AI/manual/semantic等
│   ├─ 強度別           ← 閾値によるフィルタリング
│   └─ 作成日時別       ← 関係性の作成時期
└─ 👁️ 表示制御
    ├─ ノード表示/非表示   ← 基本的な表示切り替え
    ├─ エッジ表示/非表示   ← 関係性ライン表示制御
    └─ フィルター結果適用  ← 設定したフィルターの適用/解除
```

## 🔧 実装方針

### 段階1: メインメニュー構造変更
1. 現在の横並びボタンを**5つ**のメインカテゴリーに集約
2. 各カテゴリークリックでサイドピーク表示
3. フローティングコントロール（ズーム+/-）は従来通り右下固定
4. 左下フィルター領域は「Search & Filter」サイドピークに移行

### 段階2: Relations サイドピーク実装
1. 既存のRelations関連7機能をサイドピーク内に移行
2. **タブ1「作成・設定」**: パラメータ設定 + 作成実行 + 結果表示統合
3. **タブ2「関係性一覧・管理」**: 現在の関係性リスト + 一括管理機能

### 段階3: Clustering サイドピーク実装
1. 既存のクラスタリングパネルをサイドピーク形式に変更
2. **タブ1「クラスタリング実施」**: 条件設定 + 結果表示の1タブ内分割
3. **タブ2「表示中のクラスター」**: 左下フィルター領域のクラスター表示を移行
4. **タブ3「保存済みビュー」**: 既存のClusterViewManager移行

### 段階4: Theory Building サイドピーク実装
1. GroundedTheoryManagerをサイドピーク内に統合
2. 将来の分析手法追加に対応する拡張可能な構造

### 段階5: View & Navigation サイドピーク実装
1. **直接実行ボタン**: Reset View、Auto Layout、Minimap切り替えをワンクリック実行
2. **ビュー保存・管理**: 既存のViews機能を統合
3. **シンプルな構成**: 複雑なトグル分割は排除、直感的な操作重視

### 段階6: Search & Filter サイドピーク実装
1. **左下フィルター領域の完全移行**: 検索・フィルタリング機能をサイドピークに統合
2. **検索機能強化**: カード内容・タイトル・作成者・ノードIDによる多様な検索
3. **詳細フィルタリング**: カードタイプ、タグ、関係性タイプ、強度、日時による絞り込み
4. **表示制御**: ノード・エッジの表示/非表示制御

### 段階7: フローティングコントロール調整
1. ズーム+/-ボタンは独立して右下固定を維持（View & Navigationでは制御しない）
2. Minimapの表示/非表示切り替えは View & Navigation で管理
3. 直感的な操作性を確保

## 🎯 期待効果

### UI/UX改善
- **認知負荷削減**: 機能グループ別の整理により理解しやすく
- **操作効率向上**: 関連機能を一箇所で完結
- **拡張性確保**: 新機能追加時の構造的対応

### 技術的メリット
- **コード整理**: 関連機能のコンポーネント化促進
- **保守性向上**: 機能別の責任分離
- **テスト容易性**: 独立した機能単位でのテスト

## 📝 実装時の注意点

### 既存機能の保持
- 現在の全ての機能・ロジックを完全に保持
- ユーザーの操作フローを極力変更しない
- パフォーマンスの劣化を避ける

### 段階的実装
- 一度に全てを変更せず、段階的にリファクタリング
- 各段階で動作確認を徹底
- ロールバック可能な実装

### レスポンシブ対応
- サイドピークのサイズ調整
- 異なる画面サイズでの表示最適化
- モバイル対応も考慮

## ✅ 機能網羅性検証

### 現在機能の完全移行確認

#### Relations関連（7/7機能）
- ✅ 🔗 統合関係性分析（増分）
- ✅ 🗑️ Relations一括削除
- ✅ 🧹 Relations重複削除
- ✅ 🎛️ パラメータ設定
- ✅ 🔍 Relations品質分析
- ✅ 🧠 統合分析（実験版）
- ✅ 🚀 完全分析強制実行

#### Clustering関連（1+4機能）
- ✅ 🎛️ Clusteringメインボタン
- ✅ シンプルクラスタリング（タブ1条件設定）
- ✅ 高度解析クラスタリング（タブ1条件設定）
- ✅ 表示中のクラスター管理（タブ2、左下から移行）
- ✅ 保存済みクラスタービュー管理（タブ3）

#### Theory Building関連（1機能）
- ✅ 🧠 Grounded Theory Analysis管理

#### View & Navigation関連（4機能）
- ✅ 🔄 Reset View（直接実行ボタン）
- ✅ 🗺️ Mini Map表示切り替え（直接実行ボタン）
- ✅ 🎯 Auto Layout実行（直接実行ボタン）
- ✅ 💾 Views保存・管理（既存機能統合）

#### Search & Filter関連（新設）
- ✅ 🔍 ノード検索機能（カード内容・タイトル・作成者・ID）
- ✅ 🏷️ ノート（カード）フィルタリング（タイプ・タグ・日時・作成者）
- ✅ 🔗 関係性フィルタリング（タイプ・強度・日時）
- ✅ 👁️ 表示制御（ノード・エッジ表示/非表示）

#### Floating Controls（3機能）
- ✅ + ズームイン（右下固定維持）
- ✅ − ズームアウト（右下固定維持）
- ✅ Minimap表示（制御はView & Navigationに移行）

#### その他UI要素（2機能）
- ✅ 関係性候補表示パネル（Relationsタブ1に統合）
- ✅ 各種設定モーダル（現状維持）
※左下フィルター領域は「Search & Filter」サイドピークに完全移行

### 機能拡張計画（将来実装予定）
- 🔮 将来の分析手法追加（Theory Building内）

**📊 結果: 現在の全機能（計21機能）を5つのメインカテゴリーに完全網羅！**

**機能数変更の詳細:**
- Relations: 7機能（変更なし）
- Clustering: 5機能（変更なし）  
- Theory Building: 1機能（変更なし）
- View & Navigation: 4機能（変更なし）
- **Search & Filter: 4機能（新設カテゴリー、左下フィルター領域から移行）**
- Floating Controls: 3機能（ズーム制御はView & Navigationから分離）
- その他UI要素: 2機能（左下フィルター除去により1機能減）

**合計**: 17 → 21機能（Search & Filterの明確化により4機能追加カウント）

---

**🚀 このメニュー整理により、分析スペースがより使いやすく、拡張しやすい構造になることを目指します！**
