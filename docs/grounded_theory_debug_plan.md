# グラウンデッド・セオリー分析 デバッグ・改善計画

## 現在の状況

### 実装済み機能
- ✅ オープンコーディング（概念抽出）
- ✅ 軸足コーディング（関係分析）
- ✅ 選択的コーディング（中核概念特定・仮説生成）
- ✅ UI統合（🧠 理論構築モードボタン）
- ✅ 結果パネル（GroundedTheoryResultPanel）

### 報告された問題
1. **分析時間が長い**：「分析中のままかなり長くなっている」
2. **中核概念の質の問題**：「話者１とか、重心キーワードではなく、発言者のラベルが上がってきているのは違和感」
3. **仮説の重複**：「仮説が2つだが、ほぼ同じ」
4. **カテゴリ数不足**：「1つのカテゴリはちょっと少なすぎる。多分正しくカテゴライズされていない」
5. **原因条件欠如**：「原因条件が出されていない」
6. **UI表示問題**：「UI実装がなされておらず、ブラウザーアラートで表示される」

## デバッグ・改善計画

### Phase 1: 現状分析とログ強化
**目標**：問題の根本原因を特定する

#### 実行項目
1. **処理時間分析**
   - 各フェーズ（オープン・軸足・選択的コーディング）の実行時間を計測
   - Edge Function呼び出し時間の詳細ログ
   - タイムアウト設定の確認

2. **概念抽出ロジック分析**
   - `cleanTextForConceptExtraction`の動作確認
   - AI抽出結果の品質チェック
   - 統計的抽出の結果確認

3. **カテゴリ生成ロジック分析**
   - `refineCategories`の動作確認
   - カテゴリ統合・分離のロジック検証

#### 完了条件
- [ ] 各フェーズの処理時間が特定される
- [ ] 話者ラベルが中核概念になる原因が判明
- [ ] カテゴリが1つしか生成されない原因が判明

### Phase 2: 品質フィルタリング強化
**目標**：概念とカテゴリの質を向上させる

#### 実行項目
1. **概念フィルタリング強化**
   - `isValidConcept`の条件強化
   - `isSemanticallyMeaningful`の改善
   - 話者ラベル除外ロジックの強化

2. **カテゴリ生成アルゴリズム改善**
   - カテゴリ分離条件の調整
   - 最小カテゴリ数の保証（3-5個）
   - カテゴリ間の差異化強化

3. **仮説生成の多様化**
   - 仮説テンプレートの拡充
   - 重複検知・除外ロジック
   - 原因条件の必須化

#### 完了条件
- [ ] 話者ラベルが中核概念から除外される
- [ ] 3-5個のカテゴリが安定して生成される
- [ ] 多様な仮説が生成される
- [ ] 原因条件が含まれる

### Phase 3: パフォーマンス最適化
**目標**：処理時間を短縮し、UXを向上させる

#### 実行項目
1. **処理の並列化**
   - オープンコーディングの並列実行
   - Edge Function呼び出しの最適化

2. **プログレス表示**
   - 各フェーズの進捗表示
   - 推定残り時間の表示

3. **エラーハンドリング強化**
   - タイムアウト処理
   - フォールバック機能

#### 完了条件
- [ ] 分析時間が60秒以内に短縮される
- [ ] プログレス表示が実装される
- [ ] エラー時の適切な処理が実装される

### Phase 4: UI改善
**目標**：結果表示の品質向上

#### 実行項目
1. **結果パネルの完全実装**
   - タブ形式での結果表示
   - インタラクティブな要素追加
   - データの視覚化

2. **アラート表示の廃止**
   - 全ての結果をUIパネルで表示
   - エラーメッセージの統合

#### 完了条件
- [ ] ブラウザアラートが完全に廃止される
- [ ] 結果パネルが完全に機能する
- [ ] ユーザビリティが向上する

## 最終完了条件

### 機能要件
- [ ] 分析時間が適切（60秒以内）
- [ ] 意味のある中核概念が抽出される（話者ラベル除外）
- [ ] 3-5個の多様なカテゴリが生成される
- [ ] 原因条件を含む多様な仮説が生成される
- [ ] UI表示がブラウザアラートではなくパネル表示

### 品質要件
- [ ] 分析結果の一貫性と再現性
- [ ] 適切なエラーハンドリング
- [ ] ユーザーにとって理解しやすい結果表示

### 技術要件
- [ ] コードの可読性と保守性
- [ ] 適切なログ出力とデバッグ機能
- [ ] パフォーマンスの最適化

## 次のアクション

1. **Phase 1から順次実行**
2. **各Phase完了後にユーザーフィードバックを収集**
3. **問題が解決されない場合は根本的なアプローチ変更を検討**

---
*更新日: 2024年12月27日*
*作成者: AI Assistant*
